"0",""
"0","# 如果某组 n_after 为 0，说明该组全部被过滤掉了——给出可读的报错并终止"
"0","if (any(diag_tbl$n_after == 0)) {"
"0","  problem_groups <- diag_tbl %>% filter(n_after == 0) %>% pull(Group) %>% as.character()"
"0","  message(""⚠️  以下组在计算 CR 后没有任何有效观测（全部为 NA/Inf 或 Clicks==0）： "","
"0","          paste(problem_groups, collapse = "", ""))"
"0","  message(""👉 请检查该组的 Clicks 是否全为 0/缺失，或列名是否匹配正确。"")"
"0","  # 可选：展示该组（过滤前）的 Clicks/Purchase 概览，帮助定位"
"0","  dbg <- dat_raw %>% filter(Group %in% problem_groups) %>%"
"0","    group_by(Group) %>%"
"0","    summarise("
"0","      n_rows = n(),"
"0","      zeros_clicks = sum(is.na(Clicks) | Clicks == 0, na.rm = TRUE),"
"0","      zeros_purchase = sum(is.na(Purchase) | Purchase == 0, na.rm = TRUE)"
"0","    )"
"0","  print(dbg)"
"0","  stop(""分组不足：Wilcoxon 需要两组均有 >=1 个有效 CR 才能运行。"", call. = FALSE)"
"0","}"
"0",""
"0","# 只有在两组都有有效 CR 时，才继续"
"0","dat <- dat_raw %>% filter(!is.na(CR), is.finite(CR))"
"0",""
"0","# ---------- 5) Wilcoxon 检验 ----------"
"0","wtest <- wilcox.test(CR ~ Group, data = dat, exact = FALSE,"
"0","                     conf.int = TRUE, conf.level = 0.95,"
"0","                     alternative = ""two.sided"")"
"2","Error in wilcox.test.formula(CR ~ Group, data = dat, exact = FALSE, conf.int = TRUE,  : 
  grouping factor must have exactly 2 levels
"
